{% extends "layout.html" %}

{% block title %}
    Dashboard
{% endblock %}

{% block main%}
    <div class="dashboard">
        <div class="header">
            <h1>Dashboard</h1>
            <p>An overview of your stock of beans, the amount of coffees you drank and your favourite brewing methods.</p>
        </div>
        <div class="break_line"></div>
        <div class="graphical_content">
            <div class="graphical_content_item">
                <div class="index_bar">
                    <canvas id="indexChart1"></canvas>
                </div>
            </div>
            <div class="graphical_content_item">
                <div class="index_line">
                    <canvas id="indexChart2"></canvas>
                </div>            
            </div>
        </div>
        <div class="break_line"></div>
        <div class="header">
            <h1>Register coffee use</h1>
        </div>
        <div class="coffees_input">
            <form action="/", method="post">
                <div class="coffee_input">
                    <label for="cups">Number of cups</label>
                    <input type="number" id="cups" step="1" name="cups">
                    <label for="coffee_bean_select">Beans used</label>
                    <select name="bean" id="coffee_bean_select">
                        <option value="/" disabled selected>Choose coffee bean</option>
                        {% for row in name_options %}
                        <option value="{{ row['bean_name'] }}">{{ row['bean_name'] }}</option>
                        {% endfor %}
                    </select>
                    <label for="dosage">Coffee dose</label>
                    <input type="number" id="dosage" name="dosage">
                    <label for="method">Method used</label>
                    <select name="method" id="method" name="method">
                        <option value="/" disabled selected>Choose brewing method</option>
                        <option value="espresso">Espresso</option>
                        <option value="moka">Moka</option>
                        <option value="french_press">French press</option>
                        <option value="v60">V60</option>
                        <option value="chemex">Chemex</option>
                        <option value="siphon">Siphon</option>
                    </select>
                    <button class="btn btn-secondary" type="submit">Register</button>
                </div>
            </form>
        </div>
    </div>
    

    <!--Charts script-->
    <script>
        document.addEventListener('DOMContentLoaded', function(){
    
        // Make a chart to display the coffee bean stock.
        // When the stock is too low, color in red
        // When current batch is about to expire, gray
        
        const ctx1 = document.getElementById('indexChart1');
        const ctx2 = document.getElementById('indexChart2');
        // Bar chart
        // Get th elements with the bean names and stock amount from the table
        let table_stock = {{ chart_data_stock|tojson() }};
        
        var chart_labels = [];
        var chart_stock = [];

        //Populate a list for the labels and a list for the data.
        for (let i = 0; i < table_stock.length; i++) {
            chart_labels[i] = table_stock[i]['bean_name'];
            }
        for (let i = 0; i < table_stock.length; i++) {
            chart_stock[i] = parseFloat(table_stock[i]['amount']);
            }
        
            // Checks      
        console.log('labels: ' + chart_labels);
        console.log('stocks: ' + chart_stock);

        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: chart_labels,
                datasets: [{
                label: 'Bean stock',
                data: chart_stock,
                backgroundColor: '#6F4E37',
                borderRadius: 50,
                borderWidth: 2,
                barPercentage: 0.5,
                barThickness: 20,
                minBarLength: 2,
                }]
        
            },
            options: {
                indexAxis: 'y',
                responsive: true,
            }
            });

        //  Line chart
        let line_data = {{ line_chart_data|tojson() }};

        // Checks      
        console.log('line data: ' + line_data);

        var dates = [];
        var cup_amount = [];

        //Populate a list for the dates and a list for the cups.
        for (let i = 0; i < line_data.length; i++) {
            dates[i] = line_data[i]['date'];
            }
        console.log('dates: ' + dates);

        for (let i = 0; i < line_data.length; i++) {
            cup_amount[i] = parseFloat(line_data[i]['cups']);
            }

        // Checks      
        console.log('cups: ' + cup_amount);

        const data = {
            labels: dates,
            datasets:[
                {
                label: 'Coffee cups',
                data: cup_amount,
                borderColor: 'red',
                fill: false,
                cubicInterpolationMode: 'monotone',
                tension: 0.4
                }
            ]
        };
        new Chart(ctx2, {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: {
                title: {
                    display: true,
                    text: 'Coffee cups consumption history'
                },
                },
                interaction: {
                intersect: false,
                },
                scales: {
                x: {
                    display: true,
                    title: {
                    display: true
                    }
                },
                y: {
                    display: true,
                    title: {
                    display: true,
                    text: 'Value'
                    },
                    suggestedMin: 0,
                    suggestedMax: 10
                }
                }
                        },
            });

        });
    </script>
{% endblock %}